{% extends "base.html" %}
{% load static %}
{% load tz %} {# for timezone-aware date calculations #}

{% block extra_head %}
{# Page-specific CSS or JS ONLY if required #}
{% endblock %}

{% block content %}

<!-- Hero Section -->
<section
  id="hero-section"
  class="hero-overlay d-flex align-items-center text-light position-relative"
  style="min-height: 50vh;"
>
  {% if branding.hero_image %}
    <img 
      src="{{ branding.hero_image.url }}" 
      alt="{{ branding.hero_image_alt_text|default:page_title }}"
      class="w-100 h-100 position-absolute top-0 start-0" 
      style="object-fit: cover; z-index: 1;"
    >
  {% endif %}

  <div class="container position-relative" style="z-index: 2;">
    <div class="row">
      <div class="col-lg-7">
        <h1 class="display-5 fw-bold">{{ page_title|default:"All Products" }}</h1>
        <p class="fw-bold lead mb-4 fs-5">
          Hand-crafted candles, wax melts, and gifts â€” made to order.
        </p>

        <form method="get" class="row g-2 align-items-end">

          {% if selected.type and page_title == "All Products" %}
            <input type="hidden" name="type" value="{{ selected.type }}">
          {% endif %}

          <div class="col-md-3">
            <input
              type="text"
              name="search"
              class="form-control"
              placeholder="Search products"
              value="{{ selected.search }}"
            >
          </div>

          <div class="col-md-2">
            <select name="scent" class="form-select">
              <option value="">Scent</option>
              {% for key, label in scent_choices %}
                <option value="{{ key }}" {% if selected.scent == key %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-2">
            <select name="size" class="form-select">
              <option value="">Size</option>
              {% for key, label in size_choices %}
                <option value="{{ key }}" {% if selected.size == key %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-2">
            <select name="color" class="form-select">
              <option value="">Colour</option>
              {% for key, label in color_choices %}
                <option value="{{ key }}" {% if selected.color == key %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-2">
            <input
              type="number"
              step="0.01"
              name="price"
              class="form-control"
              placeholder="Max price"
              value="{{ selected.price }}"
            >
          </div>

          <div class="col-md-1 d-grid">
            <button class="btn btn-dark">Filter</button>
          </div>
        </form>

      </div>
    </div>
  </div>
</section>

<!-- ============================= -->
<!-- Product Grid -->
<!-- ============================= -->
<section class="p-5" style="min-height: 100vh;">
  <div class="container">

    {% if products %}

        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4">
          {% for product in products %}
            {% include "_product_card.html" with product=product %}
          {% endfor %}
        </div>

    {% else %}
      <!-- Empty State -->
      <div class="text-center py-5">
        <h3 class="fw-bold">No products found</h3>
        <p class="text-muted mt-2">
          Try adjusting your filters or search terms.
        </p>
      </div>
    {% endif %}

  </div>
</section>

{% endblock %}
